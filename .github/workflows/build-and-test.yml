name: Build and test

on:
  push:
  pull_request:

jobs:
  setup:
     runs-on: ubuntu-latest
     steps:
        - uses: actions/checkout@v3
        - uses: actions/setup-node@v3
          with:
            node-version: 14
            cache: 'npm'

        - name: Install dependencies
          run: npm ci

  build:
    needs: setup
    runs-on: ubuntu-latest
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v3

      - name: Build frontend package
        run: npm build

  run-main-app-unit-tests:
      needs: build
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v3
        - uses: browser-actions/setup-chrome@latest
        - run: chrome --version

        - name: Run main app unit tests
          run: |
            cd main-app
            CHROME_BIN=$(which chrome) npm run test
